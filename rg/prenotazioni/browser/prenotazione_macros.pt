<!-- The macro used to go navigate through the weeks -->
<metal:macro metal:define-macro="week_navigator" i18n:domain="rg.prenotazioni">
  <a id="prevWeekLink" href="#"rel="nofollow"
     tal:attributes="href string:${request/getURL}?data=${week_view/prev_week}">
     &larr; settimana precedente</a>
  
  <strong><tal:month i18n:domain="plonelocales"
                     i18n:translate=""
                     content="week_view/actual_translated_month" />
          <tal:year content="week_view/actual_date/year" /></strong>
  
  <a id="nextWeekLink" href="#" rel="nofollow"
     tal:attributes="href string:${request/getURL}?data=${week_view/next_week}">
     settimana successiva &rarr;</a>
</metal:macro>

<metal:macro metal:define-macro="day_period"
    i18n:domain="rg.prenotazioni">
  <tr>
    <td tal:content="period"></td>
    <tal:days repeat="day week_view/actual_week_days">
      <td class="day"
          tal:define="interval python:week_view.prenotazioni.get_day_intervals(day)[period]"
          tal:attributes="class python:day==week_view.actual_date and 'day selected' or 'day';
                          style interval/css_styles|nothing">

        <div class="plain period"
            tal:define="slots python:week_view.prenotazioni.get_freebusy_slots(day, period);
                        booking_urls python:week_view.get_booking_urls(day, period);
                        on_move nocall:week_view|nothing">
          <div class="interval" tal:condition="python:interval and period!='stormynight'"
               tal:define="gates python:sorted(slots.keys());
                           gate_ccs_width python:int(100/len(gates))">
            <tal:from replace="interval/start" /> &mdash <tal:from replace="interval/stop" />
            <div class="gate" tal:repeat="gate python:sorted(slots.keys())"
                 tal:attributes="style string:width:${gate_ccs_width}%">
                 <metal:macro metal:use-macro="slot_macro" />
            </div>
          </div>
        </div>
      </td>
    </tal:days>
  </tr>
</metal:macro>

<metal:macro metal:define-macro="manager_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots[gate]">
    <div tal:define="booking nocall:slot/context"
         tal:attributes="class python:week_view.prenotazioni.get_state(booking);
                         style slot/css_styles">
      <div tal:condition="nocall:booking">
        <a href=""
           tal:omit-tag="not:week_view/user_can_manage"
           tal:attributes="href booking/absolute_url">
            <tal:from replace="python:week_view.DT2time(booking.getData_prenotazione())" />
            &mdash;
            <tal:to replace="python:week_view.DT2time(booking.getData_scadenza())" />
        </a>

        <tal:sposta tal:condition="week_view/user_can_manage">                        
                <a href="" class="modificaPrenotazione" title="Cambia data"
                    tal:attributes="href string:${booking/absolute_url}/prenotazione_move"><i class="icon-cut"></i></a>
        </tal:sposta>
      </div>

      <tal:booking_urls tal:condition="not:nocall:booking">
        <ul tal:condition="booking_urls">
          <li tal:repeat="booking_url booking_urls">
              <a rel="nofollow"
                 tal:attributes="href booking_url/href;
                                 title booking_url/text">+</a>
          </li>
        </ul>
      </tal:booking_urls>
    </div>
  </div>
</metal:macro>


<metal:macro metal:define-macro="onmove_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots[gate]">
    <div tal:define="booking nocall:slot/context"
                       tal:attributes="class python:view.slot_styles(slot);
                                       style slot/css_styles">
      <tal:free_slot tal:condition="not:nocall:booking">
        <tal:urls repeat="link python:view.move_to_slot_links(day, slot)">
          <a href="" title="Cambia data"
             tal:attributes="href link/url;
                             title link/title">&nbsp;</a>
        </tal:urls> 
      </tal:free_slot>
    </div>
  </div>
</metal:macro>
