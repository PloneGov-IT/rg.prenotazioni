<!-- The macro used to go navigate through the weeks -->
<metal:macro metal:define-macro="week_navigator" i18n:domain="rg.prenotazioni">
  <a id="prevWeekLink" href="#" rel="nofollow"
     tal:attributes="href week_view/prev_week_url">
     &larr; settimana precedente</a>

  <strong><tal:month i18n:domain="plonelocales"
                     i18n:translate=""
                     content="week_view/actual_translated_month" />
          <tal:year content="week_view/actual_date/year" /></strong>

  <a id="nextWeekLink" href="#" rel="nofollow"
     tal:attributes="href week_view/next_week_url">
     settimana successiva &rarr;</a>
</metal:macro>

<!-- Displays the bookability of a day period for managers -->
<metal:macro metal:define-macro="manager_day_period" i18n:domain="rg.prenotazioni">
        <div class="plain period"
            tal:define="slots python:week_view.prenotazioni.get_freebusy_slots(day, period);
                        on_move nocall:week_view|nothing">
          <div class="interval" tal:condition="python:interval and period!='stormynight'"
               tal:define="gates python:sorted(slots.keys());
                           gate_ccs_width python:int(100/len(gates))">
            <div class="fromto">
              <tal:from replace="interval/start" /> &mdash <tal:from replace="interval/stop" />
            </div>
            <div class="gateswrapper">
              <div class="gates" tal:attributes="style interval/css_styles|nothing">
                <metal:macro use-macro="prenotazione_macros/hours_column" />
                <div class="gate" tal:repeat="gate python:sorted(slots.keys())"
                     tal:attributes="style string:width:${gate_ccs_width}%">
                  <metal:macro metal:use-macro="slot_macro" />
                </div>
              </div>
            </div>
          </div>
          <div class="stormyinterval" tal:condition="python:period=='stormynight'">
            <div class="fromto" tal:condition="python:week_view.prenotazioni.get_busy_slots_in_period(day, period)"
                 i18n:translate="bookings_not_in_agenda"
            >Bookings not in agenda</div>
            <tal:gates tal:repeat="gate python:sorted(slots.keys())">
              <metal:macro metal:use-macro="prenotazione_macros/stormy_slot" />
            </tal:gates>
          </div>
        </div>
</metal:macro>

<!-- Displays the bookability of a day period for users -->
<metal:macro metal:define-macro="anonymous_day_period" i18n:domain="rg.prenotazioni">
  <div class="plain period"
      tal:condition="python:interval and period!='stormynight'"
      tal:define="slots python:week_view.prenotazioni.get_anonymous_slots(day, period);">
    <div class="interval" tal:condition="interval">
      <div class="gateswrapper">
        <div tal:attributes="style interval/css_styles|nothing">
          <div class="gate" style="width:100%">
            <metal:macro metal:use-macro="slot_macro" />
          </div>
        </div>
      </div>
    </div>
  </div>
</metal:macro>

<!-- This is the macro to show the hours left of the day period -->
<metal:macro metal:define-macro="hours_column" i18n:domain="rg.prenotazioni">
  <div class="hours" style="top:0"
        tal:attributes="style interval/css_styles|nothing"
        tal:define="hour_style python:'top:-%spx' % (float(interval._lower_value)/60)">
    <div tal:repeat="hour python:range(24)" class="hour" tal:attributes="style hour_style">
      <div tal:content="python:str(hour).zfill(2)" />
    </div>
  </div>
</metal:macro>

<!-- This is the html for a slot when we are in the week view and
     we can edit the prenotazione folder -->
<metal:macro metal:define-macro="manager_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots[gate]">
    <div tal:define="booking nocall:slot/context"
         tal:attributes="class python:week_view.prenotazioni.get_state(booking);
                         style slot/css_styles">
      <tal:comment condition="nothing">
        This is for the allocated space
      </tal:comment>
      <div tal:condition="nocall:booking">
        <a href=""
           class="popup"
           tal:attributes="href booking/absolute_url"><i class="icon-search"></i></a>
        <tal:sposta>
          <a href="" class="modificaPrenotazione" title="Cambia data"
             tal:define="data python:day.strftime('%d/%m/%Y')"
             tal:attributes="href string:${booking/absolute_url}/prenotazione_move?data=${data}"><i class="icon-cut"></i></a>
        </tal:sposta>
      </div>
      <tal:comment condition="nothing">
        This is for free space
      </tal:comment>
      <div class="links" tal:condition="not:nocall:booking">
        <tal:urls repeat="link python:week_view.prenotazioni.get_booking_urls(day, slot)">
          <a tal:attributes="href link/url;
                             title link/title;
                             class link/class">&nbsp;</a>
        </tal:urls>
      </div>
    </div>
  </div>
</metal:macro>

<!-- This is the html for a slot in the stormynight period -->
<metal:macro metal:define-macro="stormy_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots[gate]">
    <div tal:condition="nocall:slot/context"
         tal:define="booking nocall:slot/context"
         tal:attributes="class python:week_view.prenotazioni.get_state(booking);">
      <a href=""
        tal:omit-tag="not:week_view/user_can_manage"
        tal:attributes="href booking/absolute_url">
        <tal:from replace="python:week_view.DT2time(booking.getData_prenotazione())" />
        &mdash;
        <tal:to replace="python:week_view.DT2time(booking.getData_scadenza())" />
    </a>
    </div>
  </div>
</metal:macro>

<!-- This is the html for a slot when we are in the prenotazioni_move view -->
<metal:macro metal:define-macro="onmove_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots[gate]">
    <div tal:define="booking nocall:slot/context" class="links"
         tal:attributes="style python:view.slot_styles(slot)">
      <tal:free_slot tal:condition="python:not booking or booking==context">
        <tal:urls repeat="link python:view.move_to_slot_links(day, slot)">
          <a href="" title="Cambia data"
             tal:attributes="href link/url;
                             title link/title">&nbsp;</a>
        </tal:urls> 
      </tal:free_slot>
      <tal:busy_slot tal:condition="python:booking and booking!=context">
        <div tal:attributes="class string:previous;
                             style slot/css_styles">
        </div>
      </tal:busy_slot>
    </div>
  </div>
</metal:macro>

<!-- This is the html for a slot if the user is anonymous -->
<metal:macro metal:define-macro="anonymous_slot" i18n:domain="rg.prenotazioni">
  <div class="slot" tal:repeat="slot python:slots['anonymous_gate']">
    <div tal:define="booking nocall:slot/context;"
         class="anonymous_slot">
      <div tal:define="link python:week_view.prenotazioni.get_anonymous_booking_url(day, slot)">
        <tal:start replace="slot/start" />
        <tal:bookable condition="link">
          <a href=""
             tal:attributes="href link/url"
             >+</a>
        </tal:bookable>
        <tal:unbookable condition="not:link">Busy</tal:unbookable>
      </div>
    </div>
  </div>
</metal:macro>
